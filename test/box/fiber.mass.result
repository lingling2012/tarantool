lua ftest = function() box.fiber.sleep( 0.1 * math.random() ) return true end
---
...
lua ftest()
---
 - true
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
error: '[string "for i = 1, 300 do box.fiber.resume(box.fiber...."]:1: fiber.resume(): the fiber is dead'
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
error: '[string "for i = 1, 300 do box.fiber.resume(box.fiber...."]:1: fiber.resume(): the fiber is dead'
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
lua result = {}
---
...
lua for i = 1, 300 do box.fiber.resume(box.fiber.create(function() box.fiber.detach() table.insert( result, ftest() ) end )) end
---
...
lua box.fiber.sleep(.3)
---
...
lua #result
---
 - 300
...
